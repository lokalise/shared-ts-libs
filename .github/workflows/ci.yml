name: CI

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  general:
    strategy:
      matrix:
        node-version: [22.x, 24.x]
        package-name: [
          "@lokalise/api-common",
          "@lokalise/api-contracts",
          "@lokalise/auth",
          "@lokalise/aws-config",
          "@lokalise/backend-http-client",
          "@lokalise/background-jobs-common",
          "@lokalise/context-fastify-plugins",
          "@lokalise/datadog-fastify-bootstrap",
          "@lokalise/drizzle-utils",
          "@lokalise/error-utils",
          "@lokalise/fastify-api-contracts",
          "@lokalise/fastify-bullboard-plugin",
          "@lokalise/frontend-http-client",
          "@lokalise/healthcheck-utils",
          "@lokalise/id-utils",
          "@lokalise/metrics-utils",
          "@lokalise/non-translatable-markup",
          "@lokalise/odata-mapper",
          "@lokalise/opentelemetry-fastify-bootstrap",
          "@lokalise/polling",
          "@lokalise/prisma-utils",
          "@lokalise/script-utils",
          "@lokalise/supported-languages",
          "@lokalise/universal-testing-utils",
          "@lokalise/universal-ts-utils",
          "@lokalise/websockets-common",
          "@lokalise/zod-extras",
          "@lokalise/biome-config",
          "@lokalise/eslint-config",
          "@lokalise/package-vite-config",
          "@lokalise/prettier-config",
          "@lokalise/tsconfig"
        ]
    uses: ./.github/workflows/ci.package.yml
    with:
      node_version: ${{ matrix.node-version }}
      package_name: ${{ matrix.package-name }}

  automerge:
    needs: general
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
    steps:
      - uses: fastify/github-action-merge-dependabot@v3
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}